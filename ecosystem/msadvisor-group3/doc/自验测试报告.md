# 代码逻辑知识库：视图解析业务迁移优化
# 此测试文档使用的是使用媒体数据处理V1版本接口
# 调优方向一：软硬件协同调优

可参考运行环境调优知识库的若干个调优方向，详情可见: https: // gitee.com / Be - Monster / msadvisor / blob / yyh1 / doc下的文档
# 调优方向二：DVPP亲和性优化
由于样例库中的样例运行情况较为良好，故该方向上的测试暂且只有状况较好的情况（且测试中一直没有用到710服务器，很难根据实际来调优）
{
    "extendtitle": "内存ECC使能状态以及AI CPU与Ctrl CPU配比",
    "type": 0,
    "value": [
        [
            "AI CPU与Ctrl CPU的比例，内存ECC使能状态正常，没有调优建议。"
        ]
    ]
},
# 调优方向三：应用开发高性能接口

# DVPP VPC接口支持多框多图
这一块是根据样例库的样例针对各种典型情况改写的并读取的profiling数据来进行的测试
6种DVPP VPC接口使用典型情况一：单功能抠图接口，循环处理图片，给出批处理建议
{
    "datatype": [
        0
    ],
    "extendtitle": "DVPP VPC接口的选择和使用",
    "type": 0,
    "value": [
        [
            "在这个 AI 处理器上，已经使用了 VPCAPI",
            "检测到使用acldvppVpcCropAsync和acldvppVpcResizeAsync接口，同时循环处理图片，建议使用acldvppVpcBatchCropResizeAsync接口。"
        ]
    ]
},
6种DVPP VPC接口使用典型情况二：连续调用抠图与缩放接口，同时循环处理多张图，给出批处理抠图缩放单接口建议
{
    "datatype": [
        0
    ],
    "extendtitle": "DVPP VPC接口的选择和使用",
    "type": 0,
    "value": [
        [
            "在这个 AI 处理器上，已经使用了 VPCAPI",
            "检测到循环调用acldvppVpcCropResizeAsync接口，建议使用acldvppVpcBatchCropResizeAsync接口。"
        ]
    ]
}
6种DVPP VPC接口使用典型情况三：循环调用抠图缩放接口，给出单接口与批处理建议
{
    "datatype": [
        0
    ],
    "extendtitle": "DVPP VPC接口的选择和使用",
    "type": 0,
    "value": [
        [
            "在这个 AI 处理器上，已经使用了 VPCAPI",
            "检测到循环调用acldvppVpcCropAndPasteAsync接口，建议使用acldvppVpcBatchCropResizeAsync接口。"
        ]
    ]
}
6种DVPP VPC接口使用典型情况四：循环调用抠图贴图接口，给出单接口与批处理建议
{
    "datatype": [
        0
    ],
    "extendtitle": "DVPP VPC接口的选择和使用",
    "type": 0,
    "value": [
        [
            "在这个 AI 处理器上，已经使用了 VPCAPI",
            "检测到循环调用acldvppVpcCropResizePasteAsync接口，建议使用acldvppVpcBatchCropAndPasteAsync接口。"
        ]
    ]
}
6种DVPP VPC接口使用典型情况五：循环调用抠图缩放贴图接口，给出单接口与批处理建议
{
    "datatype": [
        0
    ],
    "extendtitle": "DVPP VPC接口的选择和使用",
    "type": 0,
    "value": [
        [
            "在这个 AI 处理器上，已经使用了 VPCAPI",
            "检测到循环调用acldvppVpcCropResizePasteAsync接口，建议使用acldvppVpcBatchCropResizePasteAsync接口。"
        ]
    ]
}
6种DVPP VPC接口使用典型情况六：循环调用抠图、缩放、填充接口，给出单接口与批处理建议
由于310没有这部分功能，故没法进行测试
DVPP VPC接口未使用的情况:
{
    "extendtitle": "DVPP VPC接口的选择和使用",
    "type": 0,
    "value": [
        [
            "在这个AI处理器上，可能没有使用VPCAPI接口，因而在这个方向上，知识库暂时没有调优建议。"
        ]
    ]
},
# DVPP VDEC解码抽帧
情景1:用户迁移时没有调用VDEC解码抽帧功能或正确调用了功能
{
    "extendtitle": "DVPP VDEC接口的选择和使用",
    "type": 0,
    "value": [
        [
            "在此 AI 处理器上，并没有使用到 VDECAPI接口。所以在这个方向上，知识库并没有调优建议。\n",
            "但是在视频解码+模型推理的场景下，如果用户视频的帧数很大并且不是每一帧都需要推断，建议您使用aclvdecSendSkippedFrame接口以提升使用体验。"
        ]
    ]
}
情景2:用户迁移时调用VDEC解码抽帧功能,但未合理调用此功能
{
    "datatype": [
        0
    ],
    "extendtitle": "DVPP VDEC接口的选择和使用",
    "type": 0,
    "value": [
        [
            "在这个 AI 处理器上，已经使用了 VDECAPI","检测使用acldvppVpcConvertColorAsync接口。\n"
            "如果您使用的是昇腾710 AI处理器，\n该处理器视频解码接口aclvdecSendFrame支持输出YUV420SP格式或RGB888格式，可设置接口参数输出不同的格式，\n"
            "建议省去调用acldvppVpcConvertColorAsync进行格式转换的步骤，减少接口调用。\n")
            "同时，在视频解码+模型推理的场景下，若视频的帧数比较多，且不是每一帧都需要进行推理，对于不需要推理的帧，\n"
            "推荐您使用aclvdecSendSkippedFrame接口进行解码，不输出解码结果。"
        ]
    ]
}
# AICPU自定义算子分块并行
情景1:用户迁移时并未使用到自定义算子
{
    "extendtitle": "AI CPU自定义算子开发",
    "type": 0,
    "value": [
        [
            "未检测到 AI CPU 自定义算子。"
        ]
    ]
}
情景2:用户迁移时使用到自定义算子，造成应用性能降低
{   
    "datatype": [
         0
    ],
    "extendtitle": "AI CPU自定义算子开发",
    "type": 0,
    "value": [
        [
            "建议实施 {'pool1'} 多处理器并行执行中的 ai CPU 自定义运算符"
        ]
    ]
}
# VPC输出YUV 400格式
情景1:用户迁移时并未正确使用输出格式，多余使用了色域转换功能
{   
    "datatype": [
         0
    ],
    "extendtitle": "DVPP VPC输出YUV 400格式",
    "type": 0,
    "value": [
        [
            "在 Ascend 310p AI 处理器上，VPC可以直接输出YUV400格式的图像，无需任何色域转换。"
        ]
    ]
}
情景2:用户迁移时，没有调用这部分功能或正确调用了功能
{
    "extendtitle": "DVPP VPC输出YUV 400格式",
    "type": 0,
    "value": [
        [
            "在 Ascend 310p AI 处理器上,该VPC的图像已按YUV400格式合理地输出。"
        ]
    ]
}

# 总体测试
{
    "model": {
        "running_codelogic_tuning": {
            "errorcode": 0,
            "extend": [
                {
                    "extendtitle": "内存ECC使能状态以及AI CPU与Ctrl CPU配比",
                    "type": 0,
                    "value": [
                        [
                            "AI CPU与Ctrl CPU的比例，内存ECC使能状态正常，没有调优建议。"
                        ]
                    ]
                },
                {
                    "datatype": [
                        0
                    ],
                    "extendtitle": "DVPP VPC接口的选择和使用",
                    "type": 0,
                    "value": [
                        [
                            "在这个 AI 处理器上，已经使用了 VPCAPI",
                            "检测到循环调用acldvppVpcCropResizePasteAsync接口，建议使用acldvppVpcBatchCropResizePasteAsync接口。"
                        ]
                    ]
                },
                {
                    "extendtitle": "DVPP VDEC接口的选择和使用",
                    "type": 0,
                    "value": [
                        [
                            "在此 AI 处理器上，并没有使用到 VDECAPI接口。所以在这个方向上，知识库并没有调优建议。\n",
                            "但是在视频解码+模型推理的场景下，如果用户视频的帧数很大并且不是每一帧都需要推断，建议您使用aclvdecSendSkippedFrame接口以提升使用体验。"
                        ]
                    ]
                },
                {
                    "datatype": [
                        0
                    ],
                    "extendtitle": "AI CPU自定义算子开发",
                    "type": 0,
                    "value": [
                        [
                            "建议实施 {'pool1'} 多处理器并行执行中的 ai CPU 自定义运算符"
                        ]
                    ]
                },
                {
                    "extendtitle": "DVPP VPC输出YUV 400格式",
                    "type": 0,
                    "value": [
                        [
                            "在 Ascend 310p AI 处理器上,该VPC的图像已合理地输出。"
                        ]
                    ]
                }
            ],
            "summary": "经过本知识库调优分析可得:\n
            1.在用户迁移应用中，内存ECC使能状态以及AI CPU与Ctrl CPU配比方面状况较好，该方面暂无调优意见。\n
            2.在用户迁移应用中，DVPP VPC接口的选择和使用方面需要调整优化。\n
            3.在用户迁移应用中，DVPP Vdec接口的选择和使用状况较好，该方面暂无调优意见。\n
            4.在用户迁移应用中，AI CPU自定义算子开发方面需要调整优化。\n
            5.在用户迁移应用中，DVPP VPC输出YUV 400格式方面状况较好，该方面暂无调优意见。\n"
        }
    }
}
